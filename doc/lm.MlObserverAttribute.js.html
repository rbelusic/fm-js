<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lm/ml/observers/lm.MlObserverAttribute.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: lm/ml/observers/lm.MlObserverAttribute.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* Attribute ML observer class. 
* 
* &lt;table>
* &lt;th>List of ML node attributes&lt;/th>
* &lt;tr>&lt;td>data-fmml-attr-type&lt;/td>&lt;td>type of attribute (string,number,date)&lt;/td>&lt;/tr>
* &lt;tr>&lt;td>data-fmml-date-is-utc&lt;/td>&lt;td>set true if dates is in UTC&lt;/td>&lt;/tr>
* &lt;/table>
* 
* &lt;table>
* &lt;th>List of ML CSS classes&lt;/th>
* &lt;/table>
*
* @class FM.MlObserverAttribute
* @extends FM.MlObserver
* @param {object} [attrs] DOM node attributes
* @param {DOMnode} node DOM node
*/    
FM.MlObserverAttribute = FM.defineClass('MlObserverAttribute',FM.MlObserver);


FM.MlObserverAttribute.prototype._init = function(app,attrs,node) {            
    this._super("_init",app,attrs,node);
    this.objectSubClass ="ObserverAttribute";
}        

FM.MlObserverAttribute.prototype.setNodeValue = function() {
    // conf
    var attrname = this.getAttr('data-fmml-attr-name','');
    var attrtype = this.getAttr('data-fmml-attr-type','string');
    var decplaces = parseInt(this.getAttr('data-fmml-attr-decimals','2'));
    var attrtemplate = this.getAttr('data-fmml-attr-template','');
    var dateIsUtc = this.getAttr('data-fmml-date-is-utc','true') != 'false';
    var dateFormat = this.getAttr('data-fmml-date-display-as','date');
    var defval = this.resolveAttrValue('data-fmml-attr-default-value','');
    var newlntobr = this.resolveAttrValue('data-fmml-attr-newln-br','false');
    var domprop = this.getAttr('data-fmml-observer-dom-property','');
    var dmobj = this.getDmObject();
    
    var alttext = this.getAttr('data-fmml-attr-hover-text','');
        
    // check defval    
    var value = 
        dmobj && attrname != '' ?
        dmobj.getAttr(attrname,'') :
        ''
    ;
    if(dmobj && value == '' && defval != '') {
        return dmobj.setAttr(attrname,defval,true);
    }
    
    // value
    if(value == '') value = defval;
    
    if (this.lastValue == value || dmobj == null) return;
    this.lastValue = value;
    
    // dates
    if(attrtype == "date") {
        if(FM.isDateString(value)) {
             var dateObj = FM.parseDateString(value,dateIsUtc);
            if(dateFormat == 'local') {
                value = FM.dateLocalFormat(dateObj);
            } else if(dateFormat == 'date') {
                value = FM.dateFormat(dateObj,'mediumDate');
            } else if(dateFormat == 'datetime') {
                value = FM.dateFormat(dateObj,'mediumDateTime');
            } else if(dateFormat == 'time') {
                value = FM.dateFormat(dateObj,'isoTime');
            } else if(dateFormat == 'ago') {
                value = FM.strTimeBetween(dateObj,new Date());
            } 
        }  
    } else if(attrtype == "number") {
        value = parseFloat(0.0 + value);
        value = value.toFixed(decplaces);
    }
    if(attrtemplate != "") {
        var app = this.app;
        if (newlntobr == 'true') value = value.replace(/\n/g, "&lt;br />");
        var attrlist = {
            id: value,
            alttext: alttext
        };
        var tname = attrtemplate;
        var me = this;
        
        FM.UtTemplate.getTemplate(app,attrlist,tname,function(isok,templ) {
            if(isok) {
                var tmplstr = FM.applyTemplate(attrlist, templ, false, false);
                var tmplnode = $(tmplstr);
                if(FM.isset(tmplnode[0])) tmplnode = tmplnode[0];

                me.node.innerHTML = '';
                $(me.node).append(tmplnode);
                FM.MlHost.initChildNodes(app, tmplnode);
            }
        });
    
        return;
    }
    // set
    if(domprop !== '') {
        this.node.setAttribute(domprop,value);
    } else if(attrtype == "url") {
        this.node.innerHTML = '';

        if (value != '') {
            var a = document.createElement('a');
            a.setAttribute('href', value);
            a.setAttribute('target', '_blank');
            a.innerText = value;
            
            this.node.appendChild(a);
        }
        else {
            this.node.innerHTML = '&nbsp;';
        }
    } else {    
        if(FM.isset(this.node.value)) {
            var selStart = this.node.selectionStart;
            var selEnd = this.node.selectionEnd;
            this.node.value = value;
            if(FM.isset(this.node.setSelectionRange)) {
                this.node.setSelectionRange(selStart, selEnd);
            }
        } else if(this.node.nodeName == 'IMG') {
            this.node.setAttribute("src",value);
        } else if(this.node.nodeName == 'A') {
            this.node.setAttribute("href",value);
        } else {
            if (newlntobr == 'true') value = value.replace(/\n/g, "&lt;br />");
            this.node.innerHTML = value == '' ? '&nbsp;' : value;
        }
        this.node.fmmlValueSync = value;
    }
}

FM.MlObserver.addObserver("Attribute",FM.MlObserverAttribute,'GLOBAL');
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="FM.AppObject.html">AppObject</a></li><li><a href="FM.DmGenericError.html">DmGenericError</a></li><li><a href="FM.DmGenericValue.html">DmGenericValue</a></li><li><a href="FM.DmList.html">DmList</a></li><li><a href="FM.DmObject.html">DmObject</a></li><li><a href="FM.DmTranslation.html">DmTranslation</a></li><li><a href="FM.LmObject.html">LmObject</a></li><li><a href="FM.MlAttributeEdit.html">MlAttributeEdit</a></li><li><a href="FM.MlDateAttributeEdit.html">MlDateAttributeEdit</a></li><li><a href="FM.MlDateFormat.html">MlDateFormat</a></li><li><a href="FM.MlExtension.html">MlExtension</a></li><li><a href="FM.MlHost.html">MlHost</a></li><li><a href="FM.MlHostGenericCollection.html">MlHostGenericCollection</a></li><li><a href="FM.MlHostQueryParams.html">MlHostQueryParams</a></li><li><a href="FM.MlListOfValues.html">MlListOfValues</a></li><li><a href="FM.MlObserver.html">MlObserver</a></li><li><a href="FM.MlObserverAttribute.html">MlObserverAttribute</a></li><li><a href="FM.MlObserverDisplay.html">MlObserverDisplay</a></li><li><a href="FM.MlObserverEvent.html">MlObserverEvent</a></li><li><a href="FM.MlObserverListIndex.html">MlObserverListIndex</a></li><li><a href="FM.MlObserverListOrder.html">MlObserverListOrder</a></li><li><a href="FM.MlObserverListSelection.html">MlObserverListSelection</a></li><li><a href="FM.MlObserverListState.html">MlObserverListState</a></li><li><a href="FM.MlTypeaheadMenu.html">MlTypeaheadMenu</a></li><li><a href="FM.Object.html">Object</a></li><li><a href="FM.TstAjax.html">TstAjax</a></li><li><a href="FM.TstDmList.html">TstDmList</a></li><li><a href="FM.TstGeneric.html">TstGeneric</a></li><li><a href="FM.UtAjax.html">UtAjax</a></li><li><a href="FM.UtRegistry.html">UtRegistry</a></li><li><a href="FM.UtTemplate.html">UtTemplate</a></li><li><a href="FM.UtTimer.html">UtTimer</a></li><li><a href="FM.UtTimerJob.html">UtTimerJob</a></li><li><a href="FM.UtTranslations.html">UtTranslations</a></li></ul><h3>Events</h3><ul><li><a href="FM.DmList.html#event:onAjaxStateEnd">onAjaxStateEnd</a></li><li><a href="FM.DmList.html#event:onAjaxStateError">onAjaxStateError</a></li><li><a href="FM.DmList.html#event:onAjaxStateStart">onAjaxStateStart</a></li></ul><h3>Namespaces</h3><ul><li><a href="namespace.html">Basic SDK namespace</a></li><li><a href="FM.MlObserver.validationRules.html">validationRules</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Sat Sep 28 2013 21:01:02 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
