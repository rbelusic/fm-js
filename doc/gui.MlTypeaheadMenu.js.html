<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gui/ml/gui.MlTypeaheadMenu.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: gui/ml/gui.MlTypeaheadMenu.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* ML typeahead menu edit extensions class. 
* 
* @class FM.MlTypeaheadMenu
* @extends FM.MlExtension
* @param {object} [attrs] DOM node attributes
* @param {DOMnode} node DOM node
*/
FM.MlTypeaheadMenu = FM.defineClass('MlTypeaheadMenu',FM.MlExtension);

FM.MlTypeaheadMenu.prototype._init = function(attrs,node) {
    this._super("_init",attrs,node);
    this.listCache = {};
    this.objectSubClass = "TypeaheadMenu";
}


// methods
FM.MlTypeaheadMenu.prototype._createList = function(obs) {
    var dmconfName = this.getAttr('data-fmml-list','');
    var listOpt = {};
    var pref = 'data-fmml-list-attr-';
    var prefLen = pref.length;
    
    this.forEachAttr(function(pname,value) {
        if(FM.startsWith(pname,pref)) {
            listOpt[pname.substring(prefLen)] = value;
        }                    
        return true;
    });
    
    // input param
    var oObj = obs.getDmObject();
    
    if(oObj && FM.isset(oObj.forEachAttr)) { // fm obect
        oObj.forEachAttr(function(pname,value) {
            listOpt[pname] = value;
            return true;
        });
        listOpt["objectClass"] = oObj.getSubClassName();
    } else if(FM.isArray(oObj) || FM.isObject(oObj)) { // array
        FM.forEach(oObj, function(pname,value) {
            listOpt[pname] = value;
            return true;
        });        
    }
    
    return new FM.DmList(listOpt,dmconfName,obs.getApp());
}

FM.MlTypeaheadMenu.prototype._getItemDataID = function(itm) {
    var srch = "&lt;div id='typeahead-";
    
    var itext = itm.indexOf(srch);
    if(itext &lt; 0) {
        return '';
    }
    var txt = itm.substr(itext + srch.length);
    itext = txt.indexOf("'");
    if(itext &lt; 0) {
        return '';
    }
    return txt.substr(0,itext);
}

FM.MlTypeaheadMenu.prototype.run = function(obs) {
    this._super("run",obs);
    var itmtemplate = 
        "&lt;div id='typeahead-[:data_id]' class=''>" +
        "  &lt;div class='fmmlCover pull-left'>" +
        "    &lt;img class='media-object' src='[:cover_url]'>&lt;/img>" +
        " &lt;/div>" +
        " &lt;div class='media-body'>[:description]&lt;/div>" + 
        "&lt;/div>"
    ;
    this.listCache = {};
    var me = this;
    var _obs = obs;
    
    $(_obs.getNode()).typeahead({
        updater: function(itm) {
            /*
            var srch = "&lt;div class='media-body'>";
            var qry = this.query;
            var itext = itm.indexOf(srch);
            if(itext &lt; 0) {
                return false;
            }
            var btxt = itm.substr(0,itext + srch.length);
            var txt = itm.substr(itext + srch.length);
            itext = txt.indexOf("&lt;/div>");
            if(itext &lt; 0) {
                return false;
            }
            var tag = txt.substr(0,itext);
            */
            // run host if required
            var hostid = me.getAttr('data-fmml-typeahead-add-to-on-select','');
            if(hostid != '') {
                var node = document.getElementById(hostid);
                if( node && FM.isset(node.fmmlHost) && node.fmmlHost && 
                    FM.isset(node.fmmlHost.onAddObjectToList)
                ) {
                    var o = FM.getAttr(me.listCache,itm,null);
                    if(o) node.fmmlHost.onAddObjectToList(this,{object: o});
                }
            }
            return ''; //tag;
        },
        highlighter: function(itm) {
            var o = FM.getAttr(me.listCache,itm,null);
            if(!o) return itm;
            var attr = me.getAttr('data-fmml-attr-name','');
            var menuText = me.getAttr('data-fmml-list-text-attr',attr);
            var menuImg = me.getAttr('data-fmml-img-attr','icon_url');
            
            var itmstr = FM.applyTemplate({
                    data_id: FM.md5(itm),
                    cover_url: o.getAttr(menuImg),
                    description: o.getAttr(menuText,'...')
                }, 
                itmtemplate, 
                false, false
            );
            var inode = $(itmstr)[0];

            return inode;
            
            var srch = "&lt;div class='media-body'>";
            var qry = this.query;
            var itext = itm.indexOf(srch);
            if(itext &lt; 0) {
                return false;
            }
            var btxt = itm.substr(0,itext + srch.length);
            var txt = itm.substr(itext + srch.length);
            itext = txt.indexOf("&lt;/div>");
            if(itext &lt; 0) {
                return false;
            }
            var atxt = txt.substr(itext);
            txt = txt.substr(0,itext).replace(qry,'&lt;strong>' + qry + "&lt;/strong>");
            return btxt + txt + atxt;
            
        },
        matcher: function(itm) {
            var dmobj = FM.getAttr(me.listCache,itm,null);
            var attr = me.getAttr('data-fmml-attr-name','');
            var menuText = me.getAttr('data-fmml-list-text-attr',attr);
            var txt = dmobj.getAttr(menuText,'');
            var qry = this.query;
/*            
            var srch = "&lt;div class='media-body'>";
            var itext = itm.indexOf(srch);
            if(itext &lt; 0) {
                return false;
            }
            var txt = itm.substr(itext + srch.length);
            itext = txt.indexOf("&lt;/div>");
            if(itext &lt; 0) {
                return false;
            }
            txt = txt.substr(0,itext);
*/
            return FM.isString(txt) && FM.isString(qry) && txt.toLowerCase().indexOf(qry.toLowerCase()) > -1;
        },
        source: function(val,cbFn){
            var attr = me.getAttr('data-fmml-attr-name','');
            var lstattr = me.getAttr('data-fmml-list-attr-name',attr);
            if(attr != '') {
                var dmList = me._createList(_obs);
                dmList.setAttr(lstattr,val);
                var lstnr = {
                    /** @ignore */
                    onListEnd: function(sender,data) {
                        dmList.removeListener(lstnr);
                        var menuText = obs.getAttr('data-fmml-list-text-attr',attr);
                        var menuImg = obs.getAttr('data-fmml-img-attr','icon_url');
                        var retc = [];
                        dmList.forEachListElement(function(i,o) {
                            var itmstr = FM.applyTemplate({
                                    data_id: FM.md5(o.getDataID()),
                                    cover_url: o.getAttr(menuImg),
                                    description: o.getAttr(menuText,'...')
                                }, 
                                itmtemplate, 
                                false, false
                            );
                            var inode = $(itmstr)[0];
                            inode.fmmlMenuDmObject = o;
                            retc.push(o.getDataID());
                            me.listCache[o.getDataID()] = o;
                            return true;
                        });
                        dmList.dispose();
                        cbFn(retc);
                    },
                    onListError: function(sender,data) {
                        dmList.removeListener(lstnr);
                        dmList.dispose();
                        cbFn([]);
                    }
                };
                dmList.addListener(lstnr);
                dmList.getData(false);
            }
        },
        items: parseInt(me.getAttr('data-fmml-list-size','7')),
        minLength: parseInt(me.getAttr('data-fmml-typeahead-chars','2'))
    });
    
    return true;
}


FM.MlExtension.prototype.dispose = function(obs) {
    this.listCache = {};
    this._super("dispose",obs);
    this.executed = false;
}


// static
FM.MlExtension.addExtensionType('MlTypeaheadMenu', FM.MlTypeaheadMenu);


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="FM.AppObject.html">AppObject</a></li><li><a href="FM.DmGenericError.html">DmGenericError</a></li><li><a href="FM.DmGenericValue.html">DmGenericValue</a></li><li><a href="FM.DmList.html">DmList</a></li><li><a href="FM.DmObject.html">DmObject</a></li><li><a href="FM.DmTranslation.html">DmTranslation</a></li><li><a href="FM.LmObject.html">LmObject</a></li><li><a href="FM.MlAttributeEdit.html">MlAttributeEdit</a></li><li><a href="FM.MlDateAttributeEdit.html">MlDateAttributeEdit</a></li><li><a href="FM.MlDateFormat.html">MlDateFormat</a></li><li><a href="FM.MlExtension.html">MlExtension</a></li><li><a href="FM.MlHost.html">MlHost</a></li><li><a href="FM.MlHostGenericCollection.html">MlHostGenericCollection</a></li><li><a href="FM.MlHostQueryParams.html">MlHostQueryParams</a></li><li><a href="FM.MlListOfValues.html">MlListOfValues</a></li><li><a href="FM.MlObserver.html">MlObserver</a></li><li><a href="FM.MlObserverAttribute.html">MlObserverAttribute</a></li><li><a href="FM.MlObserverDisplay.html">MlObserverDisplay</a></li><li><a href="FM.MlObserverEvent.html">MlObserverEvent</a></li><li><a href="FM.MlObserverListIndex.html">MlObserverListIndex</a></li><li><a href="FM.MlObserverListOrder.html">MlObserverListOrder</a></li><li><a href="FM.MlObserverListSelection.html">MlObserverListSelection</a></li><li><a href="FM.MlObserverListState.html">MlObserverListState</a></li><li><a href="FM.MlTypeaheadMenu.html">MlTypeaheadMenu</a></li><li><a href="FM.Object.html">Object</a></li><li><a href="FM.TstAjax.html">TstAjax</a></li><li><a href="FM.TstDmList.html">TstDmList</a></li><li><a href="FM.TstGeneric.html">TstGeneric</a></li><li><a href="FM.UtAjax.html">UtAjax</a></li><li><a href="FM.UtRegistry.html">UtRegistry</a></li><li><a href="FM.UtTemplate.html">UtTemplate</a></li><li><a href="FM.UtTimer.html">UtTimer</a></li><li><a href="FM.UtTimerJob.html">UtTimerJob</a></li><li><a href="FM.UtTranslations.html">UtTranslations</a></li></ul><h3>Events</h3><ul><li><a href="FM.DmList.html#event:onAjaxStateEnd">onAjaxStateEnd</a></li><li><a href="FM.DmList.html#event:onAjaxStateError">onAjaxStateError</a></li><li><a href="FM.DmList.html#event:onAjaxStateStart">onAjaxStateStart</a></li></ul><h3>Namespaces</h3><ul><li><a href="namespace.html">Basic SDK namespace</a></li><li><a href="FM.MlObserver.validationRules.html">validationRules</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Sat Sep 28 2013 21:01:02 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
