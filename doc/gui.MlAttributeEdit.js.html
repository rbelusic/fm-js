<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gui/ml/gui.MlAttributeEdit.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: gui/ml/gui.MlAttributeEdit.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
* ML attribute edit extensions class. 
* 
* @class FM.MlAttributeEdit
* @extends FM.MlExtension
 * @param {object} [attrs] DOM node attributes
 * @param {DOMnode} node DOM node
*/
FM.MlAttributeEdit = FM.defineClass('MlAttributeEdit',FM.MlExtension);

// methods
FM.MlAttributeEdit.prototype._init = function(attrs,node) {
    this._super("_init",attrs,node);
    this.objectSubClass = "AttributeEdit";
    this.triggerEvent = null;
    this.editWidget = null;    
}

// methods
FM.MlAttributeEdit.prototype._cleanup = function(obs) {
    if(FM.isset(this.timer) && this.timer) {
        window.clearInterval(this.timer);
        this.timer = null;
    }
    
    if(this.editWidget) {
        this.editWidget.unbind(this.triggerEvent);
        this.triggerEvent = null;
        $(this.node).unbind('click');
        $(obs.node).html("");
        this.editWidget = null;
    } else {
        if(this.triggerEvent) {
            $(this.node).unbind(this.triggerEvent);
            this.triggerEvent = null;
        }        
    }    
}

FM.MlAttributeEdit.prototype.run = function(obs) {
    this._cleanup(obs);
    this._super("run",obs);
    
    var domnode = this.node;
    this.triggerEvent = obs.getAttr('data-fmml-update-condition','blur');
    if(!FM.isset($(domnode)[this.triggerEvent])) {
        this.triggerEvent = 'blur';
    }
    this.editWidget = null;
    var me = this;
    if(domnode.nodeName == 'INPUT' || domnode.nodeName == 'TEXTAREA') {    
        $(domnode)[this.triggerEvent]/*.change | blur*/(function() {
            var value = 
                $(this).is(':checkbox') ?
                ($(this).is(":checked") ? 'true' : 'false'):
                $(this).val()
            ;   
            var savevalue = value;
            var obs = domnode.fmmlObserver;

            $(domnode).html("");
            $(domnode).text(value);

            if(obs && obs.getDmObject()) {
                var attr = obs.getAttr('data-fmml-attr-name','');
                var vtype = obs.getAttr('data-fmml-attr-type','string');                   
                var dmobj = obs.getDmObject();

                if(vtype == 'date') {
                    var isutc = obs.getAttr('data-fmml-date-is-utc','true') != 'false';
                    savevalue = FM.dateToString(FM.parseLocalDateString(value),isutc);
                }

                if(FM.isset(attr) && attr && attr != '') {
                    dmobj.setAttr(attr,savevalue,true);
                }
            }
            return true;
        }); 
        if(obs.getAttr('data-fmml-attr-value-from-dom','false') == 'true') {
            this.timer = window.setInterval(function() {
                if(FM.isset(domnode.fmmlValueSync) && obs.getNodeValue() != domnode.fmmlValueSync) {
                    var attr = obs.getAttr('data-fmml-attr-name','');
                    var dmobj = obs.getDmObject();
                    dmobj.setAttr(attr,obs.getNodeValue(),true);
                }
            },300);
        }
        
    } else if(domnode.nodeName == 'SELECT') {
        $(domnode)[this.triggerEvent]/*.change | blur*/(function() {
            var value = $(this).val();
            var savevalue = value;             
            var obs = domnode.fmmlObserver;

            if(obs && obs.getDmObject()) {
                var attr = obs.getAttr('data-fmml-attr-name','');
                var vtype = obs.getAttr('data-fmml-attr-type','string');                      
                var dmobj = obs.getDmObject();
                if(vtype == 'date') {
                    var isutc = obs.getAttr('data-fmml-date-is-utc','true') != 'false';
                    savevalue = FM.dateToString(FM.parseLocalDateString(value),isutc);
                }
                if(FM.isset(attr) && attr && attr != '') {
                    dmobj.setAttr(attr,savevalue,true);
                }
            }
            return true;
        });
    } else {
        var edittype = obs.getAttr('data-fmml-attr-edittype','input');
        
        if (edittype == 'textarea') {
            this.editWidget = $("&lt;textarea class='fmmlValueInput'>&lt;/textarea>");    
        }
        else {
            this.editWidget = $("&lt;input type='text' class='fmmlValueInput'>");
        }
        
        
        $(domnode).click(function() {
            var value = $(this).val();
            var savevalue = value;                      
            var obs = domnode.fmmlObserver;
            if(!obs || !obs.getDmObject()) {
                return true;
            }
            if($(this).children().length &lt; 1) {
                var val = $(this).text();

                if (me.editWidgetAdded != true) {
                    me.editWidget.hide();
                    $(this).after(me.editWidget);    
                }
                $(this).hide();
                
                if (edittype == 'textarea') {
                    me.editWidget.text(val);
                }
                else {
                    me.editWidget.val(val);
                }
            
                if (me.editWidgetAdded != true) {
                    me.inputAdded(obs);        
                }
            };
            me.editWidget.show();
            me.editWidget.focus();
            me.editWidgetAdded = true;
            /*
            var defevobsnodeid = me.getAttr('data-fmml-update-def-event-observer','');            
            if(defevobsnodeid != '') me.editWidget.keypress(function(e) {                
                if(e.keyCode == 13) {
                    me.editWidget[me.triggerEvent]();
                    $('#' + defevobsnodeid).click();             
                }
            });*/
            
            me.editWidget[me.triggerEvent]/*.change | blur*/(function() {
                var value = $(this).val();
                var savevalue = value;             

                $(domnode).text(value);
                $(this).hide();
                $(domnode).show();
                var obs = domnode.fmmlObserver;

                if(obs && obs.getDmObject()) {

                    var attr = obs.getAttr('data-fmml-attr-name','');
                    var vtype = obs.getAttr('data-fmml-attr-type','string');                      
                    var dmobj = obs.getDmObject();
                    if(vtype == 'date') {
                        var isutc = obs.getAttr('data-fmml-date-is-utc','true') != 'false';
                        savevalue = FM.dateToString(FM.parseLocalDateString(value),isutc);
                    }

                    if(FM.isset(attr) && attr && attr != '') {
                        dmobj.setAttr(attr,savevalue,true);
                    }
                }

                return false;
            });

            return false;
        });
    }
        
}

FM.MlAttributeEdit.prototype.dispose = function(obs) {
    this._cleanup(obs);
    
    this._super("dispose");
    this.executed = false;
}

FM.MlAttributeEdit.prototype.inputAdded = function(obs) {
}


FM.MlExtension.addExtensionType('MlAttributeEdit', FM.MlAttributeEdit);


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="FM.AppObject.html">AppObject</a></li><li><a href="FM.DmGenericError.html">DmGenericError</a></li><li><a href="FM.DmGenericValue.html">DmGenericValue</a></li><li><a href="FM.DmList.html">DmList</a></li><li><a href="FM.DmObject.html">DmObject</a></li><li><a href="FM.DmTranslation.html">DmTranslation</a></li><li><a href="FM.LmObject.html">LmObject</a></li><li><a href="FM.MlAttributeEdit.html">MlAttributeEdit</a></li><li><a href="FM.MlDateAttributeEdit.html">MlDateAttributeEdit</a></li><li><a href="FM.MlDateFormat.html">MlDateFormat</a></li><li><a href="FM.MlExtension.html">MlExtension</a></li><li><a href="FM.MlHost.html">MlHost</a></li><li><a href="FM.MlHostGenericCollection.html">MlHostGenericCollection</a></li><li><a href="FM.MlHostQueryParams.html">MlHostQueryParams</a></li><li><a href="FM.MlListOfValues.html">MlListOfValues</a></li><li><a href="FM.MlObserver.html">MlObserver</a></li><li><a href="FM.MlObserverAttribute.html">MlObserverAttribute</a></li><li><a href="FM.MlObserverDisplay.html">MlObserverDisplay</a></li><li><a href="FM.MlObserverEvent.html">MlObserverEvent</a></li><li><a href="FM.MlObserverListIndex.html">MlObserverListIndex</a></li><li><a href="FM.MlObserverListOrder.html">MlObserverListOrder</a></li><li><a href="FM.MlObserverListSelection.html">MlObserverListSelection</a></li><li><a href="FM.MlObserverListState.html">MlObserverListState</a></li><li><a href="FM.MlTypeaheadMenu.html">MlTypeaheadMenu</a></li><li><a href="FM.Object.html">Object</a></li><li><a href="FM.TstAjax.html">TstAjax</a></li><li><a href="FM.TstDmList.html">TstDmList</a></li><li><a href="FM.TstGeneric.html">TstGeneric</a></li><li><a href="FM.UtAjax.html">UtAjax</a></li><li><a href="FM.UtRegistry.html">UtRegistry</a></li><li><a href="FM.UtTemplate.html">UtTemplate</a></li><li><a href="FM.UtTimer.html">UtTimer</a></li><li><a href="FM.UtTimerJob.html">UtTimerJob</a></li><li><a href="FM.UtTranslations.html">UtTranslations</a></li></ul><h3>Events</h3><ul><li><a href="FM.DmList.html#event:onAjaxStateEnd">onAjaxStateEnd</a></li><li><a href="FM.DmList.html#event:onAjaxStateError">onAjaxStateError</a></li><li><a href="FM.DmList.html#event:onAjaxStateStart">onAjaxStateStart</a></li></ul><h3>Namespaces</h3><ul><li><a href="namespace.html">Basic SDK namespace</a></li><li><a href="FM.MlObserver.validationRules.html">validationRules</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Sat Sep 28 2013 21:01:02 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
