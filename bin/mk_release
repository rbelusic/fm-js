#!/bin/bash
echo "Release setup ..."
GIT_REV=$( git rev-parse --short HEAD) # 86fc88d
GIT_LAST_VER_TAG_LONG=$(git describe --tags --long --match v[0-9]* 2> /dev/null) # v0.8.0-1-g86fc88d
GIT_LAST_VER_TAG_SHORT=$(git describe --tags --abbrev=0 --match v[0-9]* 2> /dev/null) # v0.8.0

echo "Cloning gh-pages branch ..."
BCWD=$(pwd)
git clone -b gh-pages https://github.com/rbelusic/fm-js.git release/gh-pages
cd release/gh-pages
git checkout gh-pages

echo "Preparing release ..."
mkdir -p releases
cp -r $BCWD/build/apidoc .
zip -r $BCWD/release/gh-pages/releases/fm-js-latest $BCWD/build/*

git config user.name "$GIT_NAME"
git config user.email "$GIT_EMAIL"
git config credential.helper "store --file=.git/credentials"
echo "https://$GH_TOKEN:@github.com" >.git/credentials
git add .
git commit -m "CI script build"

echo "Pushing back to Github ..."
git push                    

echo "Done."
cd $BCWD
                 
